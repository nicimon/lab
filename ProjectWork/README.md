# Проектная работа.
# "Настройка и тестирование EVPN/VXLAN для обеспечения бесшовной миграции виртуальных машин на оборудовании Juniper"

### Цели:
* Реализация сетевой фабрики с использованием Overlay технологии VxLAN
* Сети Overlay и Underlay используется eBGP

### Описание/Пошаговая инструкция выполнения проектной работы:
Построения сетевой фабрики на основе протокола VxLAN:
#### 1) Необходимо настроить подключение нод Proxmox сразу к двум коммутаторам с использованием технологии ESI;
#### 2) Настроить маршрутизацию между сетями;
#### 3) Зафиксировать в документации - план работы, адресное пространство, схему сети, настройки сетевого оборудования.

# Выполнение:

## План выполнения проектной работы:

1) Зафиксировать параметры сети;
2) Привести схему сети;
3) Опубликовать список реализованных функций;
4) Провести проверку работы сети;
7) Опубликовать листинг команд для проверки корректной работы сети;
8) Привести конфигурации устройств.

## Параметры сети.

IP адреса Loopack интерфейсов:
Loopack-s:
<div align="center">

|             | Lo0 /32  |
|-------------|----------|
| Spine1      | 10.0.1.0 |
| Spine2      | 10.0.2.0 |

|             | Lo0 /32  |
|-------------|----------|
| Leaf1       | 10.0.1.1 |
| Leaf2       | 10.0.1.2 |
| Leaf3       | 10.0.1.3 |
| Leaf4       | 10.0.1.4 |
| BorderLeaf1 | 10.0.1.5 |
| BorderLeaf2 | 10.0.1.6 |
</div>

IP адреса P-t-P сетей

| **Connection**   	| **Spine Address** 	| **Leaf Address** 	| **Subnet**  	|
|------------------	|-------------------	|------------------	|-------------	|
| Spine 1 → Leaf 1 	| 10.2.1.0          	| 10.2.1.1         	| 10.2.1.0/31 	|
| Spine 1 → Leaf 2 	| 10.2.1.2              | 10.2.1.3          | 10.2.1.2/31  	|
| Spine 1 → Leaf 3 	| 10.2.1.4              | 10.2.1.5          | 10.2.1.4/31  	|
| Spine 1 → Leaf 4 	| 10.2.1.6          	| 10.2.1.7         	| 10.2.1.6/31 	|
| Spine 1 → BorderLeaf 1 | 10.2.1.8         | 10.2.1.9          | 10.2.1.8/31  	|
| Spine 1 → BorderLeaf 2 | 10.2.1.10        | 10.2.1.11        	| 10.2.1.10/31 	|
|------------------	|----------------------	|------------------	|-------------	|
| Spine 2 → Leaf 1 	| 10.2.2.0              | 10.2.2.1          | 10.2.2.0/31  	|
| Spine 2 → Leaf 2 	| 10.2.2.2              | 10.2.2.3          | 10.2.1.2/31  	|
| Spine 2 → Leaf 3 	| 10.2.2.4              | 10.2.2.5          | 10.2.1.4/31  	|
| Spine 2 → Leaf 4 	| 10.2.2.6              | 10.2.2.7          | 10.2.1.6/31  	|
| Spine 2 → BorderLeaf 1 | 10.2.2.8         | 10.2.2.9         | 10.2.1.8/31  	|
| Spine 2 → BorderLeaf 2 | 10.2.2.10        | 10.2.2.11          | 10.2.1.10/31 |

Таблица номеров автономных систем (AS)
<div align="center">

| Switch      |     AS     |
|-------------|------------|
| Spine1      | 4200000001 |
| Spine2      | 4200000001 |
| Leaf1       | 4200000011 |
| Leaf2       | 4200000012 |
| Leaf3       | 4200000013 |
| Leaf4       | 4200000014 |
| BorderLeaf1 | 4200000015 |
| BorderLeaf2 | 4200000016 |
</div>

#### Прочее.
В сзязи с реализацией схемы сети в виртуальной среде, необходимо в реальной сети настроить протокол BFD и выставить таймеры в протоколе BGP

### Схема связи

![Proj-1.PNG](screenshots/Proj-1.PNG)
#### Описание сети 
Необходимо реализовать схему связи предоставленную на рисунке 1. 

Cеть состоит из:

* трех Spine (Spine3 нужен для лучшей резервирования сети);
* семи Leaf из них два BorderLeaf;
* двух серверов СХД.

В процессе настройки сети в виртуальной среде потребовалось внести корректировки в исходную схему, которая предоставлена на рисунке 2 
![Proj-2.PNG](screenshots/Proj-2.PNG)

Для проверки работоспособности сети был настроена одна сеть с параментами 
| Назначение | Сервисная модель | VLAN ID/VRF name | VNI | RD | RT |
| ------------ |:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| MAC-VRF 1 | VLAN-Aware-Bundle | 100 | 10100 | (Router ID):100 | 3:3 |
| IP-VRF 1 | Symmetric IRB | Tenant1 | 10500 | (Router ID):500 | 500:500 |

### Параметры ESI для серверов:

#### Агрегация между Leaf2, Leaf3 и proxmoxnode3.
| Интерфейс | ESI ID | lacp system-id | Site |
|:---------------:|:---------------:|:---------------:|:---------------:|
| ae0 | 00:12:12:12:12:12:12:12:12:12 | 12:12:12:12:12:12 | 1 |

### Параметры на proxmoxnode3:
| Назначение | IP-шлюза | MAC | VLAN ID | VRF name | Site |
| ------------ |:---------------:|:---------------:|:---------------:|:---------------:|:---------------:|
| Bond0 | 172.20.31.120/24 | 6a:26:9a:42:60:e1 | 100 | Tenant1 | 1 |

## Список реализованных функций:

* Протокол маршрутизации для Overlay/Underlay-сети - eBGP;
* Протоколы Overlay-сети - VXLAN и EVPN;
* Проверена L2-связность L3-связность между нодами proxmox;
* Схема подключения нод proxmox - Multi-Homing (ESI);
* Трафик внутри и меджу сайтами балансируется по ECMP.

![Proj-3.PNG](screenshots/Proj-3.PNG)
